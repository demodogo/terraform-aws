      - name: AWS Scan Docker image
        id: docker-scan
        run: |
            aws ecr start-image-scan --repository-name ${{ env.ECR_NAME }} --image-id imageTag=latest

      - name: Wait for ECR Image Scan Results
        run: |
          for i in {1..10}; do
            SCAN_STATUS=$(aws ecr describe-image-scan-findings \
            --repository-name dl-web-app-ecr \
            --image-id imageTag=latest \
            --query 'imageScanStatus.status' \
            --output json)


            echo "Current scan status: $SCAN_STATUS"

            if [ "$SCAN_STATUS" = "\"COMPLETE\"" ]; then
              echo "Scan completed successfully."
              exit 0
            elif [ "$SCAN_STATUS" = "\"FAILED\"" ]; then
              echo "Scan failed."
              exit 1
            fi

            echo "Waiting for scan to complete..."
            sleep 30
          done

          echo "Scan did not complete within the expected time."
          exit 1

      - name: Get ECR Image Scan Findings
        run: |
          aws ecr describe-image-scan-findings \
            --repository-name dl-web-app-ecr \
            --image-id imageTag=latest \
            --output json > findings.json

           jq '.imageScanFindings.findings[] | {name, severity}' findings.json